pipeline {
  agent {
    docker {
      label 'SpaceJam'
      image '942037308728.dkr.ecr.us-west-1.amazonaws.com/spacejam-builds:latest'
      args '-e npm_config_cache=/npm_cache -v /opt/jenkins/cache:/npm_cache'
    }
  }
  environment {
    AWS_DEFAULT_REGION = 'us-west-2'
    AWS_REGION = 'us-west-2'
  }
  parameters {
    string(description: 'What ticket?', name: 'ticket')
  }


  stages {
    stage('Teardown'){
      steps {
        performDelete("${ticket}")
      }
    }
  }
}

void performDelete(environment) {
  env.target_environment = environment.toLowerCase()
  withAWS(credentials:'deploy-dev-dashboard', region:'us-west-2') {
      script {
        try {
            sh '''
                  cd build-deploy && sh ./teardown-bucket.sh ${target_environment}
               '''
        } catch (Exception ex) {
            sh 'echo "Could not find bucket for ${environment}"'
        }
      }
  }

}
